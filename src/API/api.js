var API=(function(){"use strict";var API=Class.create({_init_:function(){this.headers=[['Content-Type','application/json']];this.endpoints={moviesHome:'menu/[ID]?cascade=1',movie:'movies/',related:'movies/[ID]/related?cascade=2',autoComplete:'autocomplete?q=[KEY]',signin:'auth/signin',register:'auth/become-member',user:'auth/me',watchMovie:'films/[ID]/watch',help:'info/help',terms:'info/terms',about:'info/about',privacy:'info/privacy/[LANG]',moviePass:'films/[ID]/pass-status',getReminders:'member/reminders',emailAddCard:'member/email-add-card',useTicket:'films/[ID]/authorise-ticket',languages:'info/language/tv',storeCard:'member/wallet/cards',checkPinSet:'parental-control/check-pin-isset',setPin:'parental-control/set-pin',setRestriction:'parental-control/set-restriction',verifyPin:'parental-control/verify-pin',changePin:'parental-control/set-pin',recoverPin:'parental-control/recover-pin',updateSeek:'viewing-pass/[PASSID]/seek',reviewMovie:'films/[ID]/review',buyTickets:'member/wallet/purchase-ticket',myMovies:'member/films',restrictionsInfo:'info/parental-control/[LANG]',setReminder:'films/[ID]/register-interest',pinToWatch:'parental-control/is-pin-required/[ID]',searchMovie:'search/[TITLE]?cascade=2',searchCast:'movies/[NAME]/list?cascade=2',searchGenre:'genres/[GENRE]/list?cascade=2',locale:'info/locale/stripe',menu:'menu',cancelReminder:'films/[ID]/cancel-interest',homeFilms:'films/home',getTickets:'member/wallet/tickets/unused',verifyIAP:'films/[ID]/amazon-iap'};this.externalHost=config.APIHost;this.host=config.CMSAPIHost;this.stripe=config.StripeAPI;this.errorCodes={moviesHome:101,movie:102,related:103,autoComplete:104,searchMovie:105,searchCast:106,searchGenre:107,menu:108,signin:201,register:202,user:203,watchMovie:204,help:205,terms:206,privacy:207,moviePass:208,getReminders:209,emailAddCard:210,useTicket:211,languages:212,storeCard:213,checkPinSet:214,setPin:215,setRestriction:216,verifyPin:217,changePin:218,recoverPin:219,updateSeek:220,reviewMovie:221,buyTickets:222,myMovies:223,restrictionsInfo:224,setReminder:225,pinToWatch:226,locale:227,subtitles:228,storeCardGet:229,cancelReminder:230,homeFilms:231,getTickets:232,about:233,verifyIAP:234,stripe:301};},_ajax:function(url,parameters,type,headers,datatype,useJSON){var data='';if(parameters){if(datatype==='form'){}else if(useJSON){data=JSON.stringify(parameters);}else{for(var prop in parameters){if(parameters.hasOwnProperty(prop)){data+=prop+"="+encodeURIComponent(parameters[prop])+'&';}}
data=data.slice(0,data.length-1);}}
var obj={url:url,data:data,beforeSend:function(xhr){if(headers){for(var i=0;i<headers.length;i++){xhr.setRequestHeader(headers[i][0],headers[i][1]);}}},callback:function(c){},type:type,crossDomain:true};if(datatype){if(datatype!=='none'){obj.dataType=datatype;}}else{obj.dataType='json';}
return $.ajax(obj).then(function(result,textStatus,errorThrown){return{result:result,textStatus:textStatus,errorThrown:errorThrown};},function(jqXHR,textStatus,errorThrown){return{id:this.id,textStatus:textStatus,errorThrown:errorThrown,xhr:jqXHR};});},getMovies:function(call,error){var scope=this;var path=this.endpoints.moviesHome.replace('[ID]',Model.App.menuId);var lang=Model.App.file.locale.region||'GB';var url=this.host+lang+'/'+path+"&time_zone=utc";var parameters=null;var type='GET';var headers=this.headers;var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('moviesHome')]]);});},getMovie:function(id,call,error){var scope=this;var path=this.endpoints.movie;var lang=Model.App.file.locale.region||'GB';var url=this.host+lang+'/'+path+id+'?cascade=2'+ +"&time_zone=utc";var parameters=null;var type='GET';var headers=this.headers;var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('movie')]]);});},signIn:function(param,call,error){var scope=this;var path=this.endpoints.signin;var parameters=param;var url=this.externalHost+path;var type='POST';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers[0][1]='application/x-www-form-urlencoded';var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('signin')]]);});},verifyIAP:function(param,call,error){var scope=this;var path=this.endpoints.verifyIAP.replace('[ID]',param.id);var parameters={user_id:param.user_id,receipt_id:param.receipt_id};var url=this.externalHost+path;var type='POST';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);headers[0][1]='application/x-www-form-urlencoded';var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('verifyIAP')]]);});},watchMovie:function(id,call,error){console.log("Request to watch a movie...");var scope=this;var path=this.endpoints.watchMovie.replace('[ID]',id);var parameters=null;var url=this.externalHost+path;var type='GET';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('watchMovie')]]);});},getTickets:function(call,error){var scope=this;var path=this.endpoints.getTickets;var parameters=null;var url=this.externalHost+path;var type='GET';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('getTickets')]]);});},moviePass:function(id,call,error){var scope=this;var path=this.endpoints.moviePass.replace('[ID]',id);var parameters=null;var url=this.externalHost+path;var type='GET';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('moviePass')]]);});},getUser:function(call,error){var scope=this;var path=this.endpoints.user;var parameters=null;var url=this.externalHost+path;var type='GET';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('user')]]);});},setReminder:function(id,call,error){var scope=this;var path=this.endpoints.setReminder.replace('[ID]',id);var url=this.externalHost+path;var parameters=null;var type='POST';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('setReminder')]]);});},getReminders:function(call,error){var scope=this;var path=this.endpoints.getReminders;var parameters=null;var url=this.externalHost+path;var type='GET';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('getReminders')]]);});},createUser:function(param,call,error){var scope=this;var path=this.endpoints.register;var parameters=param;var url=this.externalHost+path;var type='POST';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers[0][1]='application/x-www-form-urlencoded';var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('register')]]);});},getSubtitles:function(url,call,error){var scope=this;var type='GET';var headers=null;var datatype='text';this._ajax(url,null,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('subtitles')]]);});},getHelpText:function(lang,call,error){var scope=this;var path=this.endpoints.help;var url=this.externalHost+path;var parameters=null;var type='GET';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Accept-Language',lang]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('help')]]);});},getAboutText:function(lang,call,error){var scope=this;var path=this.endpoints.about;var url=this.externalHost+path;var parameters=null;var type='GET';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Accept-Language',lang]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('about')]]);});},getTermsText:function(lang,call,error){var scope=this;var path=this.endpoints.terms;var url=this.externalHost+path;var parameters=null;var type='GET';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Accept-Language',lang]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('terms')]]);});},getPrivacyText:function(lang,call,error){var scope=this;var path=this.endpoints.privacy;var url=this.externalHost+path;var parameters=null;var type='GET';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Accept-Language',lang]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('privacy')]]);});},getLanguages:function(call,error){var scope=this;var path=this.endpoints.languages;var url=this.externalHost+path;var parameters=null;var type='GET';var headers=this.headers;var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('languages')]]);});},emailAddCard:function(call,error){var scope=this;var path=this.endpoints.emailAddCard;var url=this.externalHost+path;var parameters=null;var type='POST';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('emailAddCard')]]);});},stripeCard:function(params,call,error){var scope=this;var url=this.stripe+'?'+params;var parameters=null;var type='POST';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['Authorization','Bearer '+Model.App.file.locale.app_config.stripe_api_key]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('stripe')]]);});},storeNewCard:function(params,onSuccess,onError){var scope=this;var path=this.endpoints.storeCard;var url=this.externalHost+path;var parameters=params;var type='POST';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);headers[0][1]='application/x-www-form-urlencoded';var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){onSuccess&&onSuccess(result);}).fail(function(result){onError&&onError(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('storeCard')]]);});},getCards:function(call,error){var scope=this;var path=this.endpoints.storeCard;var url=this.externalHost+path;var parameters=null;var type='GET';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('storeCardGet')]]);});},useTicket:function(id,call,error){var scope=this;var path=this.endpoints.useTicket.replace('[ID]',id);var parameters=null;var url=this.externalHost+path;var type='POST';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('useTicket')]]);});},buyTickets:function(params,call,error){var scope=this;var path=this.endpoints.buyTickets;var parameters=params;var url=this.externalHost+path;var type='POST';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);headers[0][1]='application/x-www-form-urlencoded';var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('buyTickets')]]);});},updateSeek:function(params,call,error){var scope=this;var path=this.endpoints.updateSeek.replace('[PASSID]',params.id);var parameters={seek_time:params.seek_time,duration:params.duration,passId:params.id};var url=this.externalHost+path;var type='PUT';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);headers[0][1]='application/x-www-form-urlencoded';var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){console.log("Seek result: ",result);result.errorThrown.done(function(t){console.log("Seek error response: ",t);});call&&call(result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('updateSeek')]]);});},recoverPin:function(onSuccess,onError){var scope=this;var path=this.endpoints.recoverPin;var url=this.externalHost+path;var parameters=null;var type='POST';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){onSuccess&&onSuccess(result.result);}).fail(function(result){onError&&onError(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('recoverPin')]]);});},checkPinSet:function(onSuccess,onError){var scope=this;var path=this.endpoints.checkPinSet;var url=this.externalHost+path;var parameters=null;var type='POST';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){onSuccess&&onSuccess(result.result);}).fail(function(result){onError&&onError(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('checkPinSet')]]);});},setPin:function(param,onSuccess,onError){var scope=this;var path=this.endpoints.setPin;var url=this.externalHost+path;var parameters=param;var type='POST';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);headers[0][1]='application/x-www-form-urlencoded';var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){onSuccess&&onSuccess(result);}).fail(function(result){onError&&onError(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('setPin')]]);});},changePin:function(param,onSuccess,onError){var scope=this;var path=this.endpoints.changePin;var url=this.externalHost+path;var parameters=param;var type='PUT';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);headers[0][1]='application/x-www-form-urlencoded';var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){onSuccess&&onSuccess(result);}).fail(function(result){onError&&onError(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('changePin')]]);});},verifyPin:function(param,onSuccess,onError){var scope=this;var path=this.endpoints.verifyPin;var url=this.externalHost+path;var parameters=param;var type='POST';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);headers[0][1]='application/x-www-form-urlencoded';var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){onSuccess&&onSuccess(result);}).fail(function(result){onError&&onError(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('verifyPin')]]);});},setRestriction:function(param,onSuccess,onError){var scope=this;var path=this.endpoints.setRestriction;var url=this.externalHost+path;var parameters=param;var type='PUT';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);headers[0][1]='application/x-www-form-urlencoded';var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){onSuccess&&onSuccess(result);}).fail(function(result){onError&&onError(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('setRestriction')]]);});},reviewMovie:function(param,call,error){var scope=this;var path=this.endpoints.reviewMovie.replace('[ID]',param.id);var url=this.externalHost+path;var parameters={overall_score:param.score};var type='POST';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);var datatype='json';this._ajax(url,parameters,type,headers,datatype,false).done(function(result){call&&call(result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('reviewMovie')]]);});},getRestrictions:function(lang,onSuccess,onError){var scope=this;var path=this.endpoints.restrictionsInfo.replace('[LANG]',lang);var url=this.externalHost+path;var parameters=null;var type='GET';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){onSuccess&&onSuccess(result.result);}).fail(function(result){onError&&onError(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('restrictionsInfo')]]);});},getRelated:function(id,onSuccess,onError){var scope=this;var path=this.endpoints.related.replace('[ID]',id);var url=config.CMSAPIHost+path;var parameters=null;var type='GET';var headers=[];var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){onSuccess&&onSuccess(result.result);}).fail(function(result){onError&&onError(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('related')]]);});},getAutoCompleteSuggestions:function(key,onSuccess,onError){var scope=this;var path=this.endpoints.autoComplete.replace('[KEY]',key);var url=config.CMSAPIHost+path;var parameters=null;var type='GET';var headers=[];var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){onSuccess&&onSuccess(result.result);}).fail(function(result){onError&&onError(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('autoComplete')]]);});},pinRequiredToWatch:function(id,call,error){var scope=this;var path=this.endpoints.pinToWatch.replace('[ID]',id);var url=this.externalHost+path;var parameters=null;var type='POST';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('pinToWatch')]]);});},cancelReminder:function(id,call,error){var scope=this;var path=this.endpoints.cancelReminder.replace('[ID]',id);var url=this.externalHost+path;var parameters=null;var type='DELETE';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('cancelReminder')]]);});},getMyMovies:function(call,error){var scope=this;var path=this.endpoints.myMovies;var url=this.externalHost+path;var parameters=null;var type='GET';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);headers.push(['Authorization',Model.App.file.user.authToken]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('myMovies')]]);});},getHomeFilms:function(call,error){var scope=this;var path=this.endpoints.homeFilms;var url=this.externalHost+path;var parameters=null;var type='GET';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('homeFilms')]]);});},getLocale:function(call,error){var scope=this;var path=this.endpoints.locale;var url=this.externalHost+path;var parameters=null;var type='GET';var headers=[];for(var i=0;i<this.headers.length;i++){headers.push(this.headers[i]);}
headers.push(['X-User-Platform','tv']);headers.push(['X-User-Device','smart tv']);headers.push(['X-User-Brand',settings.device]);var lang=Model.App.file&&Model.App.file.language?Model.App.file.language:'en-GB';headers.push(['Accept-Language',lang]);var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('locale')]]);});},getMenuList:function(call,error){var scope=this;var path=this.endpoints.menu;var url=this.host+path+"?time_zone=utc";var parameters=null;var type='GET';var headers=[];var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){call&&call(result.result);}).fail(function(result){error&&error(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('menu')]]);});},getMovieSearch:function(title,onSuccess,onError){var scope=this;var path=this.endpoints.searchMovie.replace('[TITLE]',title);var url=this.host+path+"&time_zone=utc";var parameters=null;var type='GET';var headers=[];var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){onSuccess&&onSuccess(result.result);}).fail(function(result){onError&&onError(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('searchMovie')]]);});},getCastSearch:function(name,onSuccess,onError){var scope=this;var path=this.endpoints.searchCast.replace('[NAME]',name);var url=this.host+path+"&time_zone=utc";var parameters=null;var type='GET';var headers=[];var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){onSuccess&&onSuccess(result.result);}).fail(function(result){onError&&onError(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('searchCast')]]);});},getGenreSearch:function(genre,onSuccess,onError){var scope=this;var path=this.endpoints.searchGenre.replace('[GENRE]',genre);var url=this.host+path+"&time_zone=utc";var parameters=null;var type='GET';var headers=[];var datatype='json';this._ajax(url,parameters,type,headers,datatype).done(function(result){onSuccess&&onSuccess(result.result);}).fail(function(result){onError&&onError(result,scope.errorCodes[Object.keys(scope.endpoints)[Object.keys(scope.endpoints).indexOf('searchGenre')]]);});}});return new API();})();