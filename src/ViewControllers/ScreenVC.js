(function(){"use strict";var base=ViewControllerManager.findClass("ViewControllerNav");ViewControllerManager.newClassDef("ScreenVC",Class.create({_extends_:base,_init_:function(args){base.call(this,args);this.activeChild='now_showing';this.navigation={btnSignIn:{Down:'btnRegister'},btnRegister:{Up:'btnSignIn'}};this.categoryIndex=0;this.widgetName=null;Model.App.refreshLibrary=true;},onLoad:function(){},render:function(location){this._super(location);$('#backIconBackground #backIcon').html(language[Model.App.file.language].common.btn_menu);if(TVA.device==='lg'||TVA.device==='webos'){$('#Screen').css('background-image','url("./css/assets/background.png")');}},setScreen:function(movieData,title,category){var scope=this;var widgetType=null;$('#Screen #title').html(title);$('#Screen #title').show();$('#backIconBackground #backIcon').html(language[Model.App.file.language].common.btn_menu);switch(category){case'NowShowing':this.widgetName='now_showing_screen';widgetType='grid_vertical_coverart';break;case'ComingSoon':this.widgetName='upcoming_screen';widgetType='grid_vertical_coverart';for(var i=0;i<movieData.length;i++){movieData[i].date=movieData[i].release_date;}
break;case'RedCarpet':this.widgetName='red_carpet_screen';widgetType='carousel_vertical_premiere';break;case'AllMovies':this.widgetName='all_movies_screen';widgetType='grid_vertical_coverart';break;}
if(category==='MyMovies'){if(Model.App.refreshLibrary&&Model.App.loggedIn){Model.App.refreshLibrary=false;this.getMyMovies(function(){scope.createMyMoviesList();},function(){});}else{this.createMyMoviesList();Model.App.profileState="myMovies";}
$('#myMoviesList .CarouselsList_Container').css({top:0});}else{this.createMovieList(movieData,true,widgetType);}},onKeyDown:function(e,keyCode){TVA.log('keydown in '+this.name);$('.Arrow.hoverButton').removeClass('active');if(Model.App.listen){switch(keyCode){case Keys.getBind("Circle"):case Keys.getBind("Back"):this.back(e);e.stopPropagation();break;case Keys.getBind("Exit"):this.exit();e.stopPropagation();break;case Keys.getBind("Left"):this.back(e);e.stopPropagation();break;case Keys.getBind("Right"):e.stopPropagation();break;case Keys.getBind("Up"):this._navigate("Up",e);break;case Keys.getBind("Down"):this._navigate("Down",e);e.stopPropagation();break;case Keys.getBind("Cross"):case Keys.getBind("Enter"):$('#'+TVA.onFocus).click();e.stopPropagation();break;}}},_navigate:function(direction,e){try{var nextChild=this.navigation[this.activeChild][direction];if(nextChild&&this.children[nextChild]){this.children[nextChild].view.enable();e.stopPropagation();}else if($(this.rootID).find('#'+nextChild).length){TVA.setFocus(nextChild);this.activeChild=nextChild;$(this.rootID+' .gridElement').removeClass('active');$('#'+nextChild.replace('_Overlay','')).addClass('active');e.stopPropagation();}}catch(err){}},back:function(e){Model.App.fromMyMovies=false;Model.App.fromProfile=false;Model.App.fromDetails=false;var home=ViewControllerManager.find('Home');$('.gridElement.active').removeClass('active');home.showSideMenu();home.children['mainMenu'].view.enable();home.navigation.mainMenu.Right='Screen';},createMovieList:function(carouselData,activate,widgetType){Util.showSpriteLoader();$('#ScreenContent').html('');var callBacks={clickCB:this.clickCB,keydownCB:this.keydownCB,hoverCB:this.onHover};var params={activate:activate,carouselData:carouselData};this.removeChildren();if(widgetType){params.widgetType=widgetType;}
WidgetManager.addWidget(this,this.widgetName,'#ScreenContent',callBacks,params);Util.hideSpriteLoader();},keydownCB:function(e){$('#backIcon').removeClass('active');Util.revealEllipsedText('#'+TVA.onFocus.replace('_Overlay','')+' .movieTitleContainer p:nth-child(1)');},clickCB:function(e){var self=this;var home=ViewControllerManager.find('Home');var categoryName=this.name.replace('_screen','').replace('myMovies_','');var id='';if(categoryName==='reminders'||categoryName==='active_films'||categoryName==='past_films'){id=Model.App.movieIDMap[Model.myMovies.films[categoryName][this.pos].id];}else{if(categoryName==='all_movies'){id=Model.Movies.films.all[this.pos+(this.row*this.columns)].id;}else{for(var i=0;i<Model.Movies.films.length;i++){if(Model.Movies.films[i].title===categoryName){id=Model.Movies.films[i].movies[this.pos+(this.row*this.columns)].id;break;}}}}
Util.showSpriteLoader();API.getMovie(id,function(data){Model.App['returnFromDetailsTo']={parent:'Screen',screen:'Screen'};Model.App['movie']=data;ViewControllerManager.find('Home').handleRequiredPin();},function(res,errorCode){Model.App.errorCode=errorCode;home.publish('Error');});},onHover:function(event){var id=event.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.id;switch(id){case'myMovies_active_films':$('#myMoviesList #myMovies_reminders .gridElement.active').removeClass('active');$('#myMoviesList #myMovies_past_films .gridElement.active').removeClass('active');break;case'myMovies_reminders':$('#myMoviesList #myMovies_active_films .gridElement.active').removeClass('active');$('#myMoviesList #myMovies_past_films .gridElement.active').removeClass('active');break;case'myMovies_past_films':$('#myMoviesList #myMovies_active_films .gridElement.active').removeClass('active');$('#myMoviesList #myMovies_reminders .gridElement.active').removeClass('active');break;}
if(event.target&&event.target.id!==''&&$('#'+event.target.id).hasClass('btn')){TVA.setFocus(event.target.id);}
var home=ViewControllerManager.find('Home');home.hideSideMenu();Util.revealEllipsedText('#'+TVA.onFocus.replace('_Overlay','')+' .movieTitleContainer p:nth-child(1)');},onClick:function(event){var id=event.target.id;var home=ViewControllerManager.find('Home');var profile=ViewControllerManager.find('Profile');if(id==='btnSignIn'){profile.showSignIn();}else if(id==='btnRegister'){profile.showRegister();}
Util.hideSpriteLoader();},getMyMovies:function(call,error){var scope=this;Util.showSpriteLoader();if(Model.App.loggedIn){API.getMyMovies(function(res){Model['myMovies']=res;call&&call();$('#myMoviesList .CarouselsList_Container').css({top:0});},function(res,errorCode){error&&error();Model.App.errorCode=errorCode;scope.publish('Error');});}else{call&&call();}},createMyMoviesList:function(){Util.showSpriteLoader();$('#ScreenContent').html('');var scope=this;scope.removeChildren();var params;if(Model.App.loggedIn){params={x:80,y:100,width:1120,height:560};WidgetManager.addWidget(scope,'myMoviesList','#ScreenContent',{},params);var callBacks={clickCB:scope.clickCB,keydownCB:scope.keydownCB,hoverCB:scope.onHover};var carouselData=[];var title='';var widgetType='carousel_horizontal_coverart';if(Model.myMovies&&(Model.myMovies.films.active_films.length>0||Model.myMovies.films.past_films.length>0||Model.myMovies.films.reminders.length>0)){var available=null;var reminders=null;var watched=null;for(var category in Model.myMovies.films){var categoryObj=Model.myMovies.films[category];var categoryTitle=Model.myMovies.meta[category].title;var widgetName='myMovies_'+category;if(categoryObj.length>0){carouselData=[];for(var i=0;i<categoryObj.length;i++){var film=categoryObj[i];if(Model.App.movieIDMap[film.id]){var cloudinary_id=film.cover_art[0].cloudinary_id;params={image:cloudinary_id,movieTitle:film.title};carouselData.push(params);}}
if(category==='active_films'){available={widgetName:widgetName,callBacks:callBacks,carouselData:carouselData,categoryTitle:categoryTitle,widgetType:widgetType};}
if(category==='reminders'){reminders={widgetName:widgetName,callBacks:callBacks,carouselData:carouselData,categoryTitle:categoryTitle,widgetType:widgetType};}
if(category==='past_films'){watched={widgetName:widgetName,callBacks:callBacks,carouselData:carouselData,categoryTitle:categoryTitle,widgetType:widgetType};}}}
if(available){scope.children['myMoviesList'].view.addCarousel(available.widgetName,available.callBacks,available.carouselData,available.categoryTitle,available.widgetType);}
if(reminders){scope.children['myMoviesList'].view.addCarousel(reminders.widgetName,reminders.callBacks,reminders.carouselData,reminders.categoryTitle,reminders.widgetType);}
if(watched){scope.children['myMoviesList'].view.addCarousel(watched.widgetName,watched.callBacks,watched.carouselData,watched.categoryTitle,watched.widgetType);}
var children=ViewControllerManager.find('myMoviesList').children;ViewControllerManager.find('myMoviesList').activeChild=children[Object.keys(children)[0]].view.name;ViewControllerManager.find('Home').setActiveChild('mainMenu');ViewControllerManager.find('Home').enable();if(Model.App.loginFromMyMovies){setTimeout(function(){scope.back();},100);Model.App.loginFromMyMovies=false;}}else{$('#ScreenContent').html('<div id="noMovieData">'+language[Model.App.file.language].myMoviesScreen.noContent.replace('\n','<br>')+'</div>');ViewControllerManager.find('Home').children['mainMenu'].view.enable();}}else{var signInBtn='<div id="btnSignIn" class="btn hoveritem">'+language[Model.App.file.language].loginScreen.btn_signin+'</div>';var registerBtn='<div id="btnRegister" class="btn hoveritem">'+language[Model.App.file.language].loginScreen.btn_register+'</div>';var message='<div id="message">'+language[Model.App.file.language].loginScreen.signin_or_register+'</div>';var logo='<div id="logo"></div>';$('#ScreenContent').html('<div id="myMoviesLoggedOut">'+logo+signInBtn+registerBtn+message+'</div>');this.activeChild='btnSignIn';TVA.setFocus(this.activeChild);$('#Screen #title').hide();}
Model.App.fromMyMovies=true;Model.App.fromProfile=false;Model.App.fromDetails=false;Util.hideSpriteLoader();}}));})();