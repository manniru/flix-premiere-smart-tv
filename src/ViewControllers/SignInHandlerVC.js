(function(){"use strict";var base=ViewControllerManager.findClass("ViewControllerNav");ViewControllerManager.newClassDef("SignInHandlerVC",Class.create({_extends_:base,_init_:function(args){base.call(this,args);this.activeChild="signInHandler_btn";this.navigation={};this.secondPart=false;this.SignInEmail=undefined;this.SignInPassword=undefined;},onLoad:function(){},render:function(location){this._super(location);this._populateFields();},onKeyDown:function(e,keyCode){TVA.log('keydown in Sign In Handler');switch(keyCode){case Keys.getBind("Left"):var Keyboard=ViewControllerManager.find("Keyboard");if(Keyboard.activeChild==='signInHandler_btn'){TVA.setFocus(Keyboard.prevKey);}else{TVA.setFocus(Keyboard.activeChild);}
e.stopPropagation();break;case Keys.getBind("Cross"):case Keys.getBind("Enter"):$('#'+TVA.onFocus).click();e.stopPropagation();break;}},onHover:function(event){var element=event.target.id;this._enableElement(element);},onUnload:function(){this.activeChild='';TVA.setFocus(this.activeChild);},onClick:function(){var _this=this;var Keyboard=ViewControllerManager.find('Keyboard');if(!_this.secondPart){if(Keyboard.insertedText!==""&&this.validateEmail(Keyboard.insertedText)){$("#signInHandler_error").hide();Keyboard.passwordMode=true;Keyboard.offset=10;$("#signInHandler_info").text(language[Model.App.file.language].loginScreen.password_signin);$('#signInHandler_btn').text(language[Model.App.file.language].loginScreen.btn_signin);_this.SignInEmail=Keyboard.insertedText;_this.secondPart=true;Keyboard.resetInput();}
else{$("#signInHandler_error").text(language[Model.App.file.language].loginScreen.err_no_username);$("#signInHandler_error").show();}}else{if(Keyboard.insertedText!==""){$("#signInHandler_error").hide();Keyboard.passwordMode=false;_this.SignInPassword=Keyboard.insertedText;_this.secondPart=false;this._authenticateUser();}else{$("#signInHandler_error").text(language[Model.App.file.language].loginScreen.err_no_password);$("#signInHandler_error").show();}}},_authenticateUser:function(){var _this=this;var Keyboard=ViewControllerManager.find('Keyboard');var Profile=ViewControllerManager.find('Profile');var Home=ViewControllerManager.find('Home');var input=$('#keyboardInput');var email=_this.SignInEmail;var pass=_this.SignInPassword;var parameters={'email':email,'password':pass};var success=function(result){ViewControllerManager.find("Home").updateHome=true;Model.App.file['user']=result.result;Model.App.file.user.authToken=result.errorThrown.getResponseHeader('Authorization');Util.saveFile(Model.App.file);Model.App.refreshLibrary=true;Model.App.loggedIn=true;API.getReminders(function(res){if(Model.myMovies){Model.myMovies.films.reminders=res;}else{Model['myMovies']={films:{reminders:res}};}},function(res,errorCode){Model.App.errorCode=errorCode;home.publish('Error');});$("#signInHandler_info").text(language[Model.App.file.language].loginScreen.email_signin);$('#signInHandler_btn').text(language[Model.App.file.language].loginScreen.btn_next);$("#signInHandler_error").hide();Keyboard.removeChild('SignInHandler');Keyboard.parentVC.onClose();Util.hideSpriteLoader();};var error=function(){$("#signInHandler_error").text(language[Model.App.file.language].loginScreen.err_wrong_credentials);$("#signInHandler_error").show();$("#signInHandler_info").text(language[Model.App.file.language].loginScreen.email_signin);$('#signInHandler_btn').text(language[Model.App.file.language].loginScreen.btn_next);input=$('#keyboardInput');input.html(_this.SignInEmail);Keyboard.insertedText=input.text();clearTimeout(Keyboard.passwordTimeout);input.css('letter-spacing','1px');Util.hideSpriteLoader();};Util.showSpriteLoader();API.signIn(parameters,success,error);},_populateFields:function(){$("#signInHandler_info").text(language[Model.App.file.language].loginScreen.email_signin);$("#signInHandler_error").text(language[Model.App.file.language].loginScreen.err_wrong_credentials);$("#signInHandler_error").hide();$('#signInHandler_btn').text(language[Model.App.file.language].loginScreen.btn_next);},validateEmail:function(email){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email);}}));})();