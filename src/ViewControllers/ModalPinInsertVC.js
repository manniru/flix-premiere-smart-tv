(function(){"use strict";var base=ViewControllerManager.findClass("ViewControllerNav");ViewControllerManager.newClassDef("ModalPinInsertVC",Class.create({_extends_:base,_init_:function(args){base.call(this,args);this.activeChild='pin_keyboard_1';this.navigation={'pin_keyboard_1':{Down:"pin_keyboard_6",Right:"pin_keyboard_2"},'pin_keyboard_2':{Left:"pin_keyboard_1",Right:"pin_keyboard_3",Down:"pin_keyboard_7"},'pin_keyboard_3':{Left:"pin_keyboard_2",Right:"pin_keyboard_4",Down:"pin_keyboard_8"},'pin_keyboard_4':{Left:"pin_keyboard_3",Right:"pin_keyboard_5",Down:"pin_keyboard_9"},'pin_keyboard_5':{Left:"pin_keyboard_4",Down:"pin_keyboard_0"},'pin_keyboard_6':{Up:"pin_keyboard_1",Right:"pin_keyboard_7",Down:"pin_keyboard_del"},'pin_keyboard_7':{Up:"pin_keyboard_2",Left:"pin_keyboard_6",Right:"pin_keyboard_8",Down:"pin_keyboard_del"},'pin_keyboard_8':{Up:"pin_keyboard_3",Left:"pin_keyboard_7",Right:"pin_keyboard_9",Down:"pin_keyboard_del"},'pin_keyboard_9':{Up:"pin_keyboard_4",Left:"pin_keyboard_8",Right:"pin_keyboard_0",Down:"pin_keyboard_clear"},'pin_keyboard_0':{Up:"pin_keyboard_5",Left:"pin_keyboard_9",Down:"pin_keyboard_clear"},'pin_keyboard_del':{Up:"pin_keyboard_6",Down:"pin_btn_confirm",Right:"pin_keyboard_clear"},'pin_keyboard_clear':{Up:"pin_keyboard_9",Down:"pin_btn_confirm",Left:"pin_keyboard_del"},'pin_btn_confirm':{Up:"pin_keyboard_del"}};this.password='';this.passwordTimeout=undefined;this.aux=undefined;this.n_pin=undefined;this.o_pin=undefined;var self=this;setInterval(function(){if(self.input)
self.input.toggleClass('has-cursor');},500);},onLoad:function(){$('#ModalContent').addClass('moveUp');$('#Header').hide();if(Model.App.pinState==='insert_to_change'){this.password='';$('#popup_pinInput').html(this.password);}},onUnload:function(){$('#ModalContent').removeClass('moveUp');},render:function(location){this._super(location);this.enable();if(Model.App.pinState==='create'){this.password='';$('#popup_pinInput').html(this.password);$('#popup_pin_description').text(language[Model.App.file.language].pinScreen.setPin);}else{this.password='';$('#popup_pinInput').html(this.password);$('#popup_pin_description').text(language[Model.App.file.language].pinScreen.verifyPin);}
this._enableElement('pin_keyboard_1');this.input=$('#popup_pinInput');this._populateFields();},onKeyDown:function(e,keyCode){TVA.log('keydown in Pin Insert popup');$('.hoveritemBack').removeClass('active');if(Model.App.listen){switch(keyCode){case Keys.getBind("Circle"):case Keys.getBind("Back"):this.password='';this.onClose();e.stopPropagation();break;case Keys.getBind("Up"):this._navigate("Up",e);e.stopPropagation();break;case Keys.getBind("Down"):this._navigate("Down",e);e.stopPropagation();break;case Keys.getBind("Left"):this._navigate("Left",e);e.stopPropagation();break;case Keys.getBind("Right"):this._navigate("Right",e);e.stopPropagation();break;case Keys.getBind("Cross"):case Keys.getBind("Enter"):$('#'+TVA.onFocus).click();e.stopPropagation();break;}}},onClose:function(){$(this.rootID+' .active').removeClass('active');$('#popup_pin_error').hide();var parentalControls=ViewControllerManager.find("ParentalControls");var Profile=ViewControllerManager.find('Profile');if(Model.App.pinState==='create'){this.aux=this.password;if(TVA.onFocus==="pin_btn_confirm"){}else{this.password='';}
$(this.rootID).removeClass('collapse');this.parentVC.backToPrevious();if(!Model.App.pinSet){parentalControls.goBack();}
$('#Header').show();Profile.enable();}else if(Model.App.pinState==='insert_to_change'){if(TVA.onFocus==="pin_btn_confirm"){}else{this.password='';}
$(this.rootID).removeClass('collapse');this.parentVC.backToPrevious();$('#Header').show();Profile.enable();}else if(Model.App.pinState==='insert'){if(TVA.onFocus==="pin_btn_confirm"){}else{this.password='';}
$(this.rootID).removeClass('collapse');this.parentVC.backToPrevious();$('#Header').show();}else{this.parentVC.backToPrevious();}},onMouseLeave:function(e){$('#'+e.target.id).removeClass('active');},onBackHover:function(e){$('#'+e.target.id).addClass('active');},onHover:function(event){var element=event.target.id;this._enableElement(element);event.stopPropagation();},pinInsert:function(event){var bull;if(this.passwordTimeout){clearTimeout(this.passwordTimeout);bull=this._createBullets();$('#popup_pinInput').html(bull);}
if(this.password.length<=3){var aux=TVA.onFocus.substring(13,14);bull=this._createBullets();$('#popup_pinInput').html(bull+aux);this.password=this.password+aux;this.passwordTimeout=setTimeout(function(){bull+='•';$('#popup_pinInput').html(bull);},1000);}
event.stopPropagation();},clearBtn:function(event){clearTimeout(this.passwordTimeout);this.password='';$('#popup_pinInput').html(this.password);event.stopPropagation();},delBtn:function(event){if(this.passwordTimeout){clearTimeout(this.passwordTimeout);}
this.password=this.password.substring(0,this.password.length-1);var bull=this._createBullets();$('#popup_pinInput').html(bull);event.stopPropagation();},_createBullets:function(){var bull='';for(var i=0;i<this.password.length;i++){bull+='•';}
return bull;},confirmPin:function(){var _this=this;Model.App.showPinBeforeDetails=true;var pin;if(this.password.length<4){$('#popup_pin_error').text(language[Model.App.file.language].pinScreen.err_wrong_pin);$('#popup_pin_error').css('left','482px');$('#popup_pin_error').show();clearTimeout(this.passwordTimeout);this.password='';$('#popup_pinInput').html(this.password);event.stopPropagation();}else{if(this.password.length===4&&Model.App.pinState==='create'){var Profile=ViewControllerManager.find('Profile');this._setPin(function(){$('#popup_pin_error').hide();_this.onClose();});}else if(this.password.length===4&&Model.App.pinState==='insert_to_change'){_this.o_pin=this.password;pin={'pin':_this.o_pin};API.verifyPin(pin,function(result){$('#popup_pin_description').text(language[Model.App.file.language].pinScreen.changePin);$('#popup_pin_error').hide();Model.App.pinState='change';clearTimeout(_this.passwordTimeout);_this.password='';$('#popup_pinInput').html(_this.password);event.stopPropagation();},function(result){$('#popup_pin_error').text(language[Model.App.file.language].pinScreen.err_wrong_pin);$('#popup_pin_error').css('left','482px');$('#popup_pin_error').show();});}else if(this.password.length===4&&Model.App.pinState==='change'){_this.n_pin=this.password;var parameters={'new_pin':_this.n_pin,'old_pin':_this.o_pin};API.changePin(parameters,function(){_this.aux=_this.password;$('#popup_pin_error').hide();Model.App.file.user.pin=_this.n_pin;$(_this.rootID).removeClass('collapse');_this.parentVC.backToPrevious();$('#Header').show();ViewControllerManager.find("ParentalControls").askedPin=true;var Root=ViewControllerManager.find("Root");Root.publish('Information');$('#info_popup_description').html("Your Pin has been changed.");},function(result){$('#popup_pin_error').text(language[Model.App.file.language].pinScreen.err_different_pin);$('#popup_pin_error').css('left','310px');$('#popup_pin_error').show();});}else if(this.password.length===4&&Model.App.pinState==='insert'){var o=this.password;pin={'pin':o};API.verifyPin(pin,function(result){Model.App.file.user.pin=o;$('#popup_pin_error').hide();clearTimeout(_this.passwordTimeout);_this.password='';$('#popup_pinInput').html(_this.password);if(Model.App.watchFromPin){Model.App.watchFromPin=false;Util.showSpriteLoader();Model.App.showPinBeforeDetails=false;ViewControllerManager.find("Home").goToDetails();setTimeout(function(){Model.App.showPinBeforeDetails=true;},1800000);}else{ViewControllerManager.find("ParentalControls").askedPin=true;var ParentalControls=ViewControllerManager.find("ParentalControls");var aux=ParentalControls.activeChild;ParentalControls._handleClicks(aux);}
_this.onClose();event.stopPropagation();},function(result){$('#popup_pin_error').text(language[Model.App.file.language].pinScreen.err_wrong_pin);$('#popup_pin_error').css('left','482px');$('#popup_pin_error').show();});}}},_setPin:function(call){var a=this.password.toString();var parameters={'new_pin':a};Model.App.pinSet=false;var sucess=function(result){var c=result;Model.App.file.user.pin=a;Model.App.pinSet=true;call&&call();};var error=function(result,errorCode){var b=result;Model.App.errorCode=errorCode;home.publish('Error');};API.setPin(parameters,sucess,error);},_populateFields:function(){$('#pin_btn_confirm').text(language[Model.App.file.language].pinScreen.confirmPin);$('#pin_back').text(language[Model.App.file.language].common.btn_back);$('#pin_keyboard_del').text(language[Model.App.file.language].common.delete);$('#pin_keyboard_clear').text(language[Model.App.file.language].common.clear);}}));})();