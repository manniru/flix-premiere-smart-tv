(function(){'use strict';var base=ViewControllerManager.findClass('ViewControllerNav');ViewControllerManager.newClassDef('ModalResumeVC',Class.create({_extends_:base,_init_:function(args){base.call(this,args);this.activeChild='resume_yes_btn';this.navigation={'resume_yes_btn':{Right:'resume_restart_btn'},'resume_restart_btn':{Left:'resume_yes_btn'}};},onLoad:function(){$('#ModalContent').addClass('moveUp');$('#Header').hide();},onUnload:function(){$('#ModalContent').removeClass('moveUp');},render:function(location){this._super(location);this.enable();this._populateFields();},onKeyDown:function(e,keyCode){TVA.log('keydown in Exit popup');$('.hoveritemBack').removeClass('active');if(Model.App.listen){switch(keyCode){case Keys.getBind('Circle'):case Keys.getBind('Back'):this.back();e.stopPropagation();break;case Keys.getBind('Up'):this._navigate('Up',e);e.stopPropagation();break;case Keys.getBind('Down'):this._navigate('Down',e);e.stopPropagation();break;case Keys.getBind('Left'):this._navigate('Left',e);e.stopPropagation();break;case Keys.getBind('Right'):this._navigate('Right',e);e.stopPropagation();break;case Keys.getBind('Cross'):case Keys.getBind('Enter'):$('#'+TVA.onFocus).click();break;}}},back:function(){$(this.rootID+' .active').removeClass('active');this.parentVC.backToPrevious();ViewControllerManager.find('Player').back();},onClose:function(){this.parentVC.backToPrevious();},onHover:function(event){var element=event.target.id;this._enableElement(element);},onMouseLeave:function(e){$('#'+e.target.id).removeClass('active');},onBackHover:function(e){$('#'+e.target.id).addClass('active');},onResume:function(){this.onClose();this._playMovie(true);},onRestart:function(){this.onClose();this._playMovie(false);},_playMovie:function(resume){Util.showSpriteLoader();var player=ViewControllerManager.find('Player');TVA.log("About to play movie. Resume: "+resume);API.watchMovie(Model.App.movie.flix_id,function(res){Model.App.seekTime=0;Model.App.movie.url=res.url;if(resume&&res.seek_time>0&&res.seek_time<Model.App.movie.duration_seconds-20){Model.App.seekTime=res.seek_time;TVA.log("Seek time: "+Model.App.seekTime);}else{player.waitToShowResume=false;}
if(settings.device==='chrome'){VideoController.setURL('http://p.demo.flowplayer.netdna-cdn.com/vod/demo.flowplayer/bbb-800.mp4');}else{VideoController.setURL(Model.App.movie.url);}
var resumableDevices=['androidtv','firetv'];if(resumableDevices.indexOf(settings.device)>-1&&isFinite(Model.App.seekTime)&&Model.App.seekTime!==0)
player.playPause(Model.App.seekTime);else{TVA.log("----- No resume for you...");player.playPause();}
Util.hideSpriteLoader();},function(res,errorCode){Util.hideSpriteLoader();Model.App.errorCode=errorCode;home.publish('Error');});},_populateFields:function(){$('#resume_popup_description').text(language[Model.App.file.language].playerScreen.resume);$('#resume_yes_btn').text(language[Model.App.file.language].playerScreen.btn_resume);$('#resume_restart_btn').text(language[Model.App.file.language].playerScreen.btn_restart);}}));})();