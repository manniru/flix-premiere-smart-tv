(function(){'use strict';var base=ViewControllerManager.findClass('ViewControllerNav');ViewControllerManager.newClassDef('MediaPlayerVC',Class.create({_extends_:base,_init_:function(args){base.call(this,args);this.activeChild='playPause';this.navigation={'skipBack':{Right:'playPause',Up:'media_player_thumbs'},'playPause':{Left:'skipBack',Right:'skipForward',Up:'media_player_thumbs'},'skipForward':{Left:'playPause',Up:'media_player_thumbs'},media_player_thumbs:{Down:'playPause'}};this.direction=1;this.slideIntervalRef=null;this.slideCountDownIntervalRef=null;this.previewImages=[];this.thumbElements=[];this.slideIndex=0;this.slideInterval=3000;this.slideCountDown=null;this.playing=false;this.immediateHideMenu=false;},onUnload:function(){},onLoad:function(){},render:function(location){var scope=this;this._super(location);this.enable();this.createSlides();$('#MediaPlayer').find('#back').text(language[Model.App.file.language].common.btn_back);this.showMenu();},onMouseLeave:function(e){$('#'+e.target.id).removeClass('active');},onBackHover:function(e){$('#'+e.target.id).addClass('active');},onHover:function(e){$('#media_player_thumbs .active').removeClass('active');var element=e.target.id;this._enableElement(element);this.showMenu();},onKeyDown:function(e,keyCode){if(Model.App.listen&&this.listen){$('.hoveritemBack').removeClass('active');switch(keyCode){case Keys.getBind('Circle'):case Keys.getBind('Back'):this.back();e.stopImmediatePropagation();e.stopPropagation();break;case Keys.getBind('Up'):this._navigate('Up',e);e.stopPropagation();break;case Keys.getBind('Down'):var focusEl=TVA.onFocus;$('#media_player_thumbs').find('.active').removeClass('active');if(TVA.onFocus.split('pos_').length>1){this.slideIndex=parseInt(TVA.onFocus.split('pos_')[1].split('_')[0]);this.drawCounter();}
this._navigate('Down',e);e.stopPropagation();break;case Keys.getBind('Left'):this._navigate('Left',e);e.stopPropagation();break;case Keys.getBind('Right'):this._navigate('Right',e);e.stopPropagation();break;case Keys.getBind('Play'):this.playPause();break;case Keys.getBind('Pause'):this.playPause();break;case Keys.getBind('Cross'):case Keys.getBind('Enter'):$('#'+TVA.onFocus).click();e.stopImmediatePropagation();break;}}
this.showMenu();e.stopPropagation();},back:function(){this.pause();var root=ViewControllerManager.find('Root');root.removeChild('MediaPlayer');root.children['Home'].view.enable();$('#AppContent').show();$('#main-background').show();this.slideIndex=0;clearTimeout(this.timeout);clearInterval(this.slideIntervalRef);clearInterval(this.slideCountDownIntervalRef);},hideMenu:function(hide){var scope=this;var height=$('#PlayerControls').css('height');$('#PlayerControls').css({'transition-duration':'2s'});$('#PlayerControls').css({bottom:('-'+height)});this.listen=false;},showMenu:function(){if(!this.disabled){$('#PlayerControls').css({'transition-duration':'1s'});$('#PlayerControls').css({bottom:0});this.listen=true;var scope=this;clearTimeout(scope.timeout);if(this.immediateHideMenu){this.immediateHideMenu=false;this.hideMenu();}else{scope.timeout=setTimeout(function(){scope.hideMenu();},3000);}}},playPause:function(){if(this.playing){this.pause();}else{this.play();}
this._enableElement('playpause');},play:function(seektime){this.beginAutoSlide();$('#playPause').removeClass('paused');$('#playPause').addClass('playing');this.immediateHideMenu=true;},pause:function(){this.endAutoSlide();$('#playPause').removeClass('playing');$('#playPause').addClass('paused');$('#progress').css({width:0});},disableControls:function(){this.disabled=true;this.hideMenu();},enableControls:function(){this.disabled=false;this.showMenu();},playHead:function(seconds){var progress=(settings.device==='panasonic')?(seconds/this.slideInterval)*120:(seconds/this.slideInterval)*100;$('#progress').css({width:progress+'%'});},forward:function(){if(this.playing)
this.pause();$('#playSpeedBox .arrows').removeClass('backward').addClass('forward');var dir=1;if(this.slideIndex<Model.App.movie.imagery.stills.length-1){this.changeSlide(this.slideIndex,dir);this.children['media_player_thumbs'].view.scrollTo(0,this.slideIndex,'Right');var nextChild=this.navigation[this.activeChild]['Down'];TVA.setFocus('skipForward');this.activeChild='skipForward';}},backward:function(){if(this.playing)
this.pause();$('#playSpeedBox .arrows').removeClass('forward').addClass('backward');var dir=-1;if(this.slideIndex>0){this.changeSlide(this.slideIndex,dir);this.children['media_player_thumbs'].view.scrollTo(0,this.slideIndex,'Right');var nextChild=this.navigation[this.activeChild]['Down'];TVA.setFocus('skipBack');this.activeChild='skipBack';}},createThumbnailCarousel:function(data){var callBacks={clickCB:this.eventChangeSlide,keydownCB:this.keydownCBEvent
};var carouselData=[];for(var i=0;i<data.length;i++){carouselData.push(data[i]);}
var params={activate:false,carouselData:carouselData};this.removeChildren();WidgetManager.addWidget(this,'media_player_thumbs','#thumbnailList',callBacks,params);this.children['media_player_thumbs'].view.scrollTo(0,this.position,'Right');this.eventChangeSlide();},keydownCBEvent:function(){$('.hoveritemBack').removeClass('active');var scope=ViewControllerManager.find('MediaPlayer');scope.slideIndex=this.pos;scope.drawCounter();scope.showMenu();},createSlides:function(){var stills=Model.App.movie.imagery.stills;$('#previewThumbs').html('');var thumbData=[];for(var i=0;i<stills.length;i++){var imgUrl=stills[i].id;var hideImage='';if(i>0){hideImage='display:none;';}
var fill="c_fill,f_auto,h_720,q_auto,w_1080/";var imgEl='<div style="background-image:url('+Model.App.file.locale.app_config.cloudinary_base_url+fill+imgUrl+'); position:absolute;'+hideImage+'"></div>';$('#previewThumbs').append(imgEl);thumbData.push(stills[i].id);}
this.slideIndex=0;this.drawCounter();this.createThumbnailCarousel(thumbData);},beginAutoSlide:function(){this.playing=true;this.direction=1;clearInterval(this.slideIntervalRef);var scope=this;this.slideIntervalRef=setInterval(function(){scope.changSlide();},scope.slideInterval);this.startSlideCountDown();},endAutoSlide:function(){this.playing=false;clearInterval(this.slideIntervalRef);this.endSlideCountDown();},changeSlide:function(i,dir){this.direction=dir;$('#previewThumbs div').hide();if(i>-1){this.slideIndex=i;}
if(this.direction===1){this.slideIndex++;if(this.slideIndex===Model.App.movie.imagery.stills.length){this.slideIndex=0;}}else{this.slideIndex--;if(this.slideIndex<0){this.slideIndex=0;}}
this.resetSlideCountDown();this.drawCounter();$('#previewThumbs div:nth-child('+(this.slideIndex+1)+')').show();},changSlide:function(i){$('#previewThumbs div').hide();if(i>-1){this.slideIndex=i;}else{if(this.direction===1){this.slideIndex++;if(this.slideIndex===Model.App.movie.imagery.stills.length){this.slideIndex=0;}}else{this.slideIndex--;if(this.slideIndex<0){this.slideIndex=0;}}
this.resetSlideCountDown();}
this.drawCounter();this.children['media_player_thumbs'].view.scrollTo(0,this.slideIndex,'Right');$('#previewThumbs div:nth-child('+(this.slideIndex+1)+')').show();},drawCounter:function(){$('#indexCounter').html((this.slideIndex+1)+'/'+Model.App.movie.imagery.stills.length);},eventChangeSlide:function(e){var scope=ViewControllerManager.find('MediaPlayer');var pos=this.pos>=0?this.pos:scope.position;scope.changSlide(pos);},startSlideCountDown:function(){var scope=this;var millis=100;clearInterval(this.slideCountDownIntervalRef);this.resetSlideCountDown();this.slideCountDownIntervalRef=setInterval(function(){scope.doSlideCountDown(millis);},millis);},endSlideCountDown:function(){clearInterval(this.slideCountDownIntervalRef);},doSlideCountDown:function(millis){this.slideCountDown-=millis;if(this.slideCountDown>0){this.playHead(this.slideInterval-this.slideCountDown);}},resetSlideCountDown:function(){this.slideCountDown=this.slideInterval;}}));})();