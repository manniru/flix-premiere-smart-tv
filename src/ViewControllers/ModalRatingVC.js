(function(){"use strict";var base=ViewControllerManager.findClass("ViewControllerNav");ViewControllerManager.newClassDef("ModalRatingVC",Class.create({_extends_:base,_init_:function(args){base.call(this,args);this.activeChild='rating_yes_btn';this.navigation={'resume_yes_btn':{Right:'resume_restart_btn'},'resume_restart_btn':{Left:'resume_yes_btn'}};},onLoad:function(){},onUnload:function(){},render:function(location){this._super(location);this.enable();$('#ModalContent').show();$('#rating_popup_movie_title').html(Model.App.movie.title);$('#rating_yes_btn').text(language[Model.App.file.language].ratingScreen.btn_confirm);$('#rating_back_btn').text(language[Model.App.file.language].common.btn_back);$('#rating_popup_heading').text(language[Model.App.file.language].ratingScreen.pleaseRate);$('#rating_popup_instruction').text(language[Model.App.file.language].ratingScreen.addStars);this.fixRating(3);this.drawRating(Model.App.movie,this.rating);},onKeyDown:function(e,keyCode){TVA.log('keydown in '+this.name);$('.hoveritemBack').removeClass('active');if(Model.App.listen){switch(keyCode){case Keys.getBind("Circle"):case Keys.getBind("Back"):this.back();e.stopPropagation();break;case Keys.getBind("Up"):this._navigate("Up",e);e.stopPropagation();break;case Keys.getBind("Down"):this._navigate("Down",e);e.stopPropagation();break;case Keys.getBind("Left"):this.decrementRating();e.stopPropagation();break;case Keys.getBind("Right"):this.incrementRating();e.stopPropagation();break;case Keys.getBind("Cross"):case Keys.getBind("Enter"):$('#'+TVA.onFocus).click();break;}}},back:function(){Model.App.promptReview=false;$(this.rootID+' .active').removeClass('active');this.parentVC.backToPrevious();},onClose:function(){Model.App.promptReview=false;this.parentVC.backToPrevious();},onMouseLeave:function(e){$('#'+e.target.id).removeClass('active');},onBackHover:function(e){$('#'+e.target.id).addClass('active');},onHover:function(event){var element=event.target.id;this._enableElement(element);},onConfirm:function(){var details=ViewControllerManager.find('Details');this.onClose();var rating=Math.ceil(this.rating);var params={id:Model.App.movie.flix_id,score:rating};API.reviewMovie(params,function(a){Model.App.promptReview=false;},function(a,errorCode){Model.App.promptReview=false;if(a.errorThrown!=='Conflict'){Model.App.errorCode=errorCode;details.publish('Error');}});},drawRating:function(movie,rating){var ratingWhole=Math.floor(rating);var ratingHalf=rating-ratingWhole;var stars='';for(var j=0;j<5;j++){if(j<ratingWhole){stars+='<div class="star wholeStar"></div>';}else if(ratingHalf>0){ratingHalf=0;stars+='<div class="star halfStar"></div>';}}
if(rating===1){stars+='<div class="star noStar"></div>';stars+='<div class="star noStar"></div>';stars+='<div class="star noStar"></div>';stars+='<div class="star noStar"></div>';}
else if(rating>1&&rating<=2){stars+='<div class="star noStar"></div>';stars+='<div class="star noStar"></div>';stars+='<div class="star noStar"></div>';}else if(rating>2&&rating<=3){stars+='<div class="star noStar"></div>';stars+='<div class="star noStar"></div>';}else if(rating>3&&rating<=4){stars+='<div class="star noStar"></div>';}
rating='<div class="rating">'+stars+'</div>';$('#rating_popup_rating').html(rating);},incrementRating:function(){if(this.rating<5)
this.rating+=1;this.drawRating(Model.App.movie,this.rating);},decrementRating:function(){if(this.rating>1)
this.rating-=1;this.drawRating(Model.App.movie,this.rating);},fixRating:function(rating){this.rating=rating;var ratingWhole=Math.floor(this.rating);var ratingHalf=this.rating-ratingWhole;if(ratingHalf!==0){this.rating=ratingWhole+0.5;}}}));})();