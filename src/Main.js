var settings={device:'',year:'',lang:'',qmenu:false,mouse:false};Main.loadMain=function(){document.addEventListener("pause",function(){console.log("Handling app pause");if(ViewControllerManager.find('Root').activeChild==='Player'){TVA.onHUD=true;}},true);document.addEventListener("resume",function(){console.log("Handling app resuming");if(ViewControllerManager.find('Root').activeChild==='Player'){var scope=ViewControllerManager.find("Player");API.watchMovie(Model.App.movie.flix_id,function(res){Util.hideSpriteLoader();TVA.onHUD=false;scope.passId=res.pass.id;scope.userLeftReview=res.member_has_left_review;Model.App.seekTime=0;Model.App.movie.url=res.url;if(settings.device==='chrome'){VideoController.setURL('http://p.demo.flowplayer.netdna-cdn.com/vod/demo.flowplayer/bbb-800.mp4');}else{VideoController.setURL(Model.App.movie.url);}
if(Model.App.movie.subtitles&&Model.App.movie.subtitles.length>0){scope.SubtitleOptions=Model.App.movie.subtitles;scope.getSubtitles(Model.App.movie.subtitles[scope.captionsIndex]);scope._showCCButton();}else{scope._hideCCButton();}
if(res.seek_time>0&&res.seek_time<Model.App.movie.duration_seconds-20){scope.waitToShowResume=true;Model.App.seekTime=res.seek_time;scope.publish('ResumeMovie');}else{scope.playPause();}
scope._setTizenResume();},function(res,errorCode){Model.App.errorCode=errorCode;home.publish('Error');});}},true);if(TVA.device==="samsung_tizen"&&typeof Main.isLoaded==="boolean"&&Main.isLoaded===true){return;}
Main.isLoaded=true;$('body').addClass(TVA.device);var initObj={debug:config.debug};TVA.init(initObj);settings.device=TVA.device.toLowerCase();$('#debugWindow').css({'text-align':'right','width':'350px','word-wrap':'break-word'});Util.openFile(config.storageName);if(settings.device.indexOf('samsung')!==-1){settings.year=TVA.year;}
settings.qmenu=navigator.userAgent.indexOf("LG NetCast.TV")>0;TVA.log('Device: '+settings.device);if(settings.device==='chrome'){TVA.log(navigator);}else{TVA.log(navigator.userAgent);}
if(settings.device==='firetv'){this._fireTVSetup();}
StyleManager.init();Main.FlixPremiereApp=new FlixPremiereApp();Main.FlixPremiereApp.Go();};Main._fireTVSetup=function(){Model.App.AmazonIAP=false;var modalPurchase=ViewControllerManager.find('modalPurchase');var scope=this;TVA.AmazonIAP.init(null,function(data){var param={user_id:data.userId,receipt_id:data.receipt.purchaseToken,id:Model.App.movie.flix_id};Util.showSpriteLoader();API.verifyIAP(param,function(data){Util.hideSpriteLoader();var res=data.result;var details=ViewControllerManager.find('Details');var MP=ViewControllerManager.find('ModalPurchase');var player=ViewControllerManager.find('Player');MP.back();Model.App.file.user.ticket_count=res.ticket_count;player.passId=res.pass_id;player.userLeftReview=res.film.member_has_left_review;Model.App.seekTime=res.film.seek_time;Model.App.movie.url=res.film.url;Model.App.AmazonIAP=true;details.showPlayer();},function(res,errorCode){Util.hideSpriteLoader();Model.App.errorCode=errorCode;Model.App.message=res.xhr.responseJSON.message;var MP=ViewControllerManager.find('ModalPurchase');MP.publish('Message');});});};Main.unload=function(){if(TVA.device==='samsung_tizen'){return;}
TVA_Player.deinit();};Main.keyDown=function(keycode){Main.FlixPremiereApp.handleKey(keycode);};