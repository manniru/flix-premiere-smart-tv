(function(){"use strict";var base=ViewControllerManager.findClass("ViewControllerNav");ViewControllerManager.newClassDef("TextScrollerVC",Class.create({_extends_:base,_init_:function(args){base.call(this,args);this.activeChild='arrow_scroll_down';this.navigation={'arrow_scroll_up':{Down:'arrow_scroll_down'},'arrow_scroll_down':{Up:'arrow_scroll_up'}};this.scrollLength=0;this.scrollCount=0;this.scrollAmount=40;this.elName='TextScroller';this.textField='textField';this.thumbHeight=10;this.text='';},init:function(text){this.text=text;this.setScroll();$('#arrow_scroll_up').addClass('end');$('#arrow_scroll_down').removeClass('end');},render:function(location){this._super(location);this.enable();},onKeyDown:function(e,keyCode){TVA.log('keydown in TextScroller');switch(keyCode){case Keys.getBind("Back"):break;case Keys.getBind("Up"):this.scrollUp(e);e.stopPropagation();break;case Keys.getBind("Down"):this.scrollDown(e);e.stopPropagation();break;case Keys.getBind("Left"):this._navigate('Left',e);break;case Keys.getBind("Right"):this._navigate('Right',e);break;case Keys.getBind("Enter"):$('#'+TVA.onFocus).click();e.stopPropagation();break;}},_navigate:function(direction,e){var nextChild=this.navigation[this.activeChild][direction];if(nextChild&&this.children[nextChild]){this.children[nextChild].view.enable();e.stopPropagation();}else if($(this.rootID).find('#'+nextChild).length){TVA.setFocus(nextChild);this.activeChild=nextChild;e.stopPropagation();}
if($('#arrow_scroll_up').hasClass('end')){$('#arrow_scroll_up').removeClass('focus');$('#arrow_scroll_down').addClass('focus');}
if($('#arrow_scroll_down').hasClass('end')){$('#arrow_scroll_down').removeClass('focus');$('#arrow_scroll_up').addClass('focus');}},scrollUp:function(e){this.scroll("up",e);},scrollDown:function(e){this.scroll("down",e);},setScroll:function(){$(this.rootID+' #textField').html(this.text);this.scrollLength=Math.ceil((document.getElementById(this.textField).scrollHeight-$('#'+this.elName).height())/this.scrollAmount);$('#thumb').css('top','0px');this.thumbHeight=$('#track').height()/this.scrollLength;$('#thumb').height(this.thumbHeight);this.scrollCount=0;$('#'+this.textField).scrollTop(0);},scroll:function(direction,e){var elName=this.textField;var scrollAmount=this.scrollAmount;var el=$('#'+elName);var elPos=el.scrollTop();var elHeight=document.getElementById(elName).scrollHeight;this.thumbHeight=$('#track').height()/this.scrollLength;var thumbPos=$('#thumb').css('top');thumbPos=parseInt(thumbPos.replace('px',''));$('#thumb').height(this.thumbHeight);if(direction==="up"){if(elPos>0){$('#arrow_scroll_up').removeClass('end');$('#arrow_scroll_down').removeClass('end');if((elPos-scrollAmount)<0){this.scrollCount=0;el.scrollTop(this.scrollCount);}else{this.scrollCount--;el.scrollTop(el.scrollTop()-scrollAmount);$('#thumb').css('top',(this.scrollCount*this.thumbHeight)+'px');this._navigate('Up',e);}}else{$('#arrow_scroll_up').addClass('end');$('#arrow_scroll_up').removeClass('focus');$('#arrow_scroll_down').addClass('focus');$('#topMask').hide();this._enableElement('arrow_scroll_down');}}else if(direction==="down"){if(this.scrollCount<this.scrollLength-1){$('#arrow_scroll_up').removeClass('end');$('#arrow_scroll_down').removeClass('end');$('#topMask').show();this.scrollCount++;el.scrollTop(el.scrollTop()+scrollAmount);$('#thumb').css('top',(this.scrollCount*this.thumbHeight)+'px');this._navigate('Down',e);return el.scrollTop()-elPos>=(scrollAmount-1);}else{$('#arrow_scroll_down').addClass('end');$('#arrow_scroll_down').removeClass('focus');$('#arrow_scroll_up').addClass('focus');this._enableElement('arrow_scroll_up');}}
return false;},onHover:function(event){this._enableElement(event.target.id);event.stopPropagation();}}));})();